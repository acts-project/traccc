# VecMem project, part of the ACTS project (R&D line)
#
# (c) 2021-2023 CERN for the benefit of the ACTS project
#
# Mozilla Public License Version 2.0

# Common CMake include(s).
include( CMakeCommonLanguageInclude )

# Set up platform specific flags.
include( Platform/${CMAKE_EFFECTIVE_SYSTEM_NAME}-${CMAKE_HIP_COMPILER_ID}-HIP
   OPTIONAL )

# Set up how HIP object file compilation should go.
if( NOT DEFINED CMAKE_HIP_COMPILE_OBJECT )
   set( CMAKE_HIP_COMPILE_OBJECT
      "<CMAKE_HIP_COMPILER> <DEFINES> <INCLUDES> <FLAGS> -o <OBJECT> -c <SOURCE>" )
endif()

# Set up how shared library building should go.
if( NOT DEFINED CMAKE_SHARED_LIBRARY_CREATE_HIP_FLAGS )
   set( CMAKE_SHARED_LIBRARY_CREATE_HIP_FLAGS
      "${CMAKE_SHARED_LIBRARY_CREATE_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_HIP_FLAGS )
   set( CMAKE_SHARED_LIBRARY_HIP_FLAGS
      "${CMAKE_SHARED_LIBRARY_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_LINK_HIP_FLAGS )
   set( CMAKE_SHARED_LIBRARY_LINK_HIP_FLAGS
      "${CMAKE_SHARED_LIBRARY_LINK_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_RUNTIME_HIP_FLAG )
   set( CMAKE_SHARED_LIBRARY_RUNTIME_HIP_FLAG
      "${CMAKE_SHARED_LIBRARY_RUNTIME_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_RUNTIME_HIP_FLAG_SEP )
   set( CMAKE_SHARED_LIBRARY_RUNTIME_HIP_FLAG_SEP
      "${CMAKE_SHARED_LIBRARY_RUNTIME_CXX_FLAG_SEP}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_RPATH_LINK_HIP_FLAG )
   set( CMAKE_SHARED_LIBRARY_RPATH_LINK_HIP_FLAG
      "${CMAKE_SHARED_LIBRARY_RPATH_LINK_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_EXPORTS_HIP_FLAG )
   set( CMAKE_SHARED_LIBRARY_EXPORTS_HIP_FLAG
      "${CMAKE_SHARED_LIBRARY_EXPORTS_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_LIBRARY_SONAME_HIP_FLAG )
   set( CMAKE_SHARED_LIBRARY_SONAME_HIP_FLAG
      "${CMAKE_SHARED_LIBRARY_SONAME_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_HIP_CREATE_SHARED_LIBRARY )
   set( CMAKE_HIP_CREATE_SHARED_LIBRARY
      "\"${CMAKE_HIP_HOST_LINKER}\" <CMAKE_SHARED_LIBRARY_HIP_FLAGS> <LANGUAGE_COMPILE_FLAGS> <LINK_FLAGS> <CMAKE_SHARED_LIBRARY_CREATE_HIP_FLAGS> <SONAME_FLAG><TARGET_SONAME> -o <TARGET> <OBJECTS> <LINK_LIBRARIES>" )
endif()

# Set up how module library building should go.
if( NOT DEFINED CMAKE_SHARED_MODULE_CREATE_HIP_FLAGS )
   set( CMAKE_SHARED_MODULE_CREATE_HIP_FLAGS
      "${CMAKE_SHARED_MODULE_CREATE_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_HIP_FLAGS )
   set( CMAKE_SHARED_MODULE_HIP_FLAGS
      "${CMAKE_SHARED_MODULE_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_LINK_HIP_FLAGS )
   set( CMAKE_SHARED_MODULE_LINK_HIP_FLAGS
      "${CMAKE_SHARED_MODULE_LINK_CXX_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_RUNTIME_HIP_FLAG )
   set( CMAKE_SHARED_MODULE_RUNTIME_HIP_FLAG
      "${CMAKE_SHARED_MODULE_RUNTIME_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_RUNTIME_HIP_FLAG_SEP )
   set( CMAKE_SHARED_MODULE_RUNTIME_HIP_FLAG_SEP
      "${CMAKE_SHARED_MODULE_RUNTIME_CXX_FLAG_SEP}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_RPATH_LINK_HIP_FLAG )
   set( CMAKE_SHARED_MODULE_RPATH_LINK_HIP_FLAG
      "${CMAKE_SHARED_MODULE_RPATH_LINK_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_EXPORTS_HIP_FLAG )
   set( CMAKE_SHARED_MODULE_EXPORTS_HIP_FLAG
      "${CMAKE_SHARED_MODULE_EXPORTS_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_SHARED_MODULE_SONAME_HIP_FLAG )
   set( CMAKE_SHARED_MODULE_SONAME_HIP_FLAG
      "${CMAKE_SHARED_MODULE_SONAME_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_HIP_CREATE_SHARED_MODULE )
   set( CMAKE_HIP_CREATE_SHARED_MODULE
      "\"${CMAKE_HIP_HOST_LINKER}\" <CMAKE_SHARED_MODULE_HIP_FLAGS> <LANGUAGE_COMPILE_FLAGS> <LINK_FLAGS> <CMAKE_SHARED_MODULE_CREATE_HIP_FLAGS> -o <TARGET> <OBJECTS> <LINK_LIBRARIES>" )
endif()

# Set up how static library building should go.
if( NOT DEFINED CMAKE_HIP_CREATE_STATIC_LIBRARY )
   set( CMAKE_HIP_CREATE_STATIC_LIBRARY "${CMAKE_CXX_CREATE_STATIC_LIBRARY}" )
endif()

# Set up how executable building should go.
if( NOT DEFINED CMAKE_HIP_LINK_FLAGS )
   set( CMAKE_HIP_LINK_FLAGS
      "${CMAKE_CXX_LINK_FLAGS}" )
endif()
if( NOT DEFINED CMAKE_EXECUTABLE_RUNTIME_HIP_FLAG )
   set( CMAKE_EXECUTABLE_RUNTIME_HIP_FLAG
      "${CMAKE_EXECUTABLE_RUNTIME_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_EXECUTABLE_RUNTIME_HIP_FLAG_SEP )
   set( CMAKE_EXECUTABLE_RUNTIME_HIP_FLAG_SEP
      "${CMAKE_EXECUTABLE_RUNTIME_CXX_FLAG_SEP}" )
endif()
if( NOT DEFINED CMAKE_EXECUTABLE_RPATH_LINK_HIP_FLAG )
   set( CMAKE_EXECUTABLE_RPATH_LINK_HIP_FLAG
      "${CMAKE_EXECUTABLE_RPATH_LINK_CXX_FLAG}" )
endif()
if( NOT DEFINED CMAKE_HIP_LINK_EXECUTABLE )
   set( CMAKE_HIP_LINK_EXECUTABLE
      "\"${CMAKE_HIP_HOST_LINKER}\" <FLAGS> <CMAKE_HIP_LINK_FLAGS> <LINK_FLAGS> <OBJECTS> -o <TARGET> <LINK_LIBRARIES>" )
endif()

# Set the include flag(s).
if( NOT DEFINED CMAKE_INCLUDE_FLAG_HIP )
   set( CMAKE_INCLUDE_FLAG_HIP "${CMAKE_INCLUDE_FLAG_CXX}" )
endif()
if( NOT DEFINED CMAKE_INCLUDE_SYSTEM_FLAG_HIP )
   set( CMAKE_INCLUDE_SYSTEM_FLAG_HIP "${CMAKE_INCLUDE_SYSTEM_FLAG_CXX}" )
endif()

# Set up the flags for the HIP build.
set( CMAKE_HIP_FLAGS_INIT "${CMAKE_HIP_FLAGS_INIT} $ENV{HIPFLAGS}" )
cmake_initialize_per_config_variable( CMAKE_HIP_FLAGS
   "Flags used by the HIP compiler" )
set( CMAKE_HIP_FLAGS
   "${CMAKE_HIP_FLAGS} ${CMAKE_HIP${CMAKE_HIP_STANDARD}_STANDARD_COMPILE_OPTION}" )

# Tell CMake that the information was loaded.
set( CMAKE_HIP_INFORMATION_LOADED TRUE )
